# 使用方法

## 基于 VIMP 协议的 MQTT 传输器用法

```js
const VIMPMQTTTransfer = require('/path/to/voerkaTransfer/protocols/vimp/vimpMqttTransfer');
const { EventMessage, ActionMessage } = require('/path/to/voerkaTransfer/protocols/vimp/message');

// 实例化
const mqttTransfer = new VIMPMQTTTransfer({
    name: '传输器名称',
    debug: 是否开启debug,
    broker: 'mqttBroker地址:端口',
    username: 'mqttBroker用户名',
    password: 'mqttBroker密码',
    will: {  // 遗嘱（示例）
        payload: new EventMessage({
            from: this.attrs.sn,
            payload: {
                code: 1001,
                level: 1,
                status: { online: false }
            }
        }),
        topic: `${this.pubPath}/$$status/online`,
        retain: true
    }
});

// 监听消息
mqttTransfer.on('data', mqttMessageHandler);
// 等待连接
await mqttTransfer.connect();
// 发送消息
mqttTransfer.send({ data: new EventMessage({...}), options: { topic } });
// 发送消息并等待应答
let response = await mqttTransfer.session().send({
    data: new ActionMessage({...}), 
    options: { topic } 
});
```

## 基于 VIMP 协议的 UDP 传输器用法

```js
const VIMPUDPTransfer = require('/path/to/voerkaTransfer/protocols/vimp/vimpUdpTransfer');
const { MQTTConfigMessage, NetworkConfigMessage } = require('/path/to/voerkaTransfer/protocols/vimp/message');

// 实例化
const udpTransfer = new VIMPUDPTransfer({
    name: '传输器名称',
    udpPort: 端口号,
});
// 监听消息
udpTransfer.on('data', mqttMessageHandler);
// 等待连接
await udpTransfer.connect();
// 发送消息并等待应答
let response1 = await udpTransfer.session().send({
    data: new MQTTConfigMessage({...}), 
    options: { topic } 
});
let response2 = await udpTransfer.session().send({
    data: new NetworkConfigMessage({...}), 
    options: { topic } 
});
```